<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Daily Office">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect width='512' height='512' fill='%235a4a3a'/><rect x='206' y='50' width='100' height='412' fill='%23f5f1e8' rx='10'/><rect x='50' y='206' width='412' height='100' fill='%23f5f1e8' rx='10'/></svg>">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%235a4a3a'/><rect x='40' y='10' width='20' height='80' fill='%23f5f1e8' rx='2'/><rect x='10' y='40' width='80' height='20' fill='%23f5f1e8' rx='2'/></svg>">
    <title>Daily Office - PCUSA</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 1.4rem;
            margin-bottom: 6px;
        }

        .liturgical-info {
            font-size: 0.8rem;
            opacity: 0.9;
            margin-top: 6px;
        }

        .season-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            margin-top: 6px;
            font-weight: bold;
        }

        .daily-art-container {
            width: 100%;
            padding: 25px;
            text-align: center;
            background: linear-gradient(to bottom, #f7fafc 0%, #edf2f7 100%);
            border-bottom: 3px solid #e2e8f0;
        }

        .daily-art {
            max-width: 280px;
            max-height: 280px;
            width: auto;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 3px solid white;
            display: block;
            margin: 0 auto;
        }

        .art-caption {
            margin-top: 12px;
            color: #2d3748;
            font-size: 0.85rem;
            font-style: italic;
            font-weight: 500;
        }

        .nav-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            padding: 20px;
            background: #f7fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .nav-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .nav-btn.active {
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .morning { background: #fef3c7; color: #92400e; }
        .morning.active { background: #fbbf24; }

        .midday { background: #dbeafe; color: #1e40af; }
        .midday.active { background: #60a5fa; }

        .evening { background: #fce7f3; color: #9f1239; }
        .evening.active { background: #f472b6; }

        .night { background: #e0e7ff; color: #3730a3; }
        .night.active { background: #818cf8; }

        .content {
            padding: 30px;
        }

        .office-section {
            display: none;
        }

        .office-section.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-size: 1.5rem;
            color: #2d3748;
            margin: 25px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }

        .prayer-text {
            line-height: 1.8;
            color: #4a5568;
            margin: 15px 0;
            font-size: 1.05rem;
        }

        .response {
            font-style: italic;
            margin-left: 20px;
            color: #718096;
        }

        .psalm {
            background: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }

        .scripture-reading {
            background: #fffbeb;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #f59e0b;
        }

        .reading-reference {
            font-weight: bold;
            color: #92400e;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .scripture-text {
            line-height: 1.8;
            margin-top: 10px;
            color: #1a202c;
        }

        .verse-number {
            font-size: 0.8rem;
            vertical-align: super;
            color: #718096;
            margin-right: 3px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #718096;
            font-style: italic;
        }

        .silence-note {
            text-align: center;
            font-style: italic;
            color: #718096;
            padding: 20px;
            background: #f7fafc;
            border-radius: 8px;
            margin: 15px 0;
        }

        .canticle {
            background: #fef3c7;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            font-style: italic;
        }

        .canticle-title {
            font-weight: bold;
            font-style: normal;
            margin-bottom: 10px;
            color: #92400e;
        }

        .instruction {
            color: #e53e3e;
            font-size: 0.9rem;
            font-style: italic;
            margin: 10px 0;
        }

        .error {
            background: #fed7d7;
            border-left: 4px solid #e53e3e;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            color: #742a2a;
        }

        /* DARK MODE */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            }

            .container {
                background: #2d3748;
            }

            .header {
                background: linear-gradient(135deg, #1a202c 0%, #0d1117 100%);
            }

            .daily-art-container {
                background: linear-gradient(to bottom, #374151 0%, #2d3748 100%);
                border-bottom: 3px solid #4a5568;
            }

            .art-caption {
                color: #e2e8f0;
            }

            .nav-buttons {
                background: #1f2937;
                border-bottom: 1px solid #374151;
            }

            .content {
                background: #2d3748;
            }

            .section-title {
                color: #e2e8f0;
                border-bottom: 2px solid #4a5568;
            }

            .prayer-text {
                color: #cbd5e0;
            }

            .response {
                color: #a0aec0;
            }

            .psalm {
                background: #374151;
                border-left: 4px solid #818cf8;
            }

            .scripture-reading {
                background: #374151;
                border-left: 4px solid #fbbf24;
            }

            .reading-reference {
                color: #fbbf24;
            }

            .scripture-text {
                color: #e2e8f0;
            }

            .verse-number {
                color: #9ca3af;
            }

            .loading {
                color: #9ca3af;
            }

            .silence-note {
                color: #a0aec0;
                background: #374151;
            }

            .canticle {
                background: #374151;
            }

            .canticle-title {
                color: #fbbf24;
            }

            .instruction {
                color: #fbbf24;
            }

            .error {
                background: #7f1d1d;
                border-left: 4px solid #dc2626;
                color: #fca5a5;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <h1>Daily Office</h1>
                <div class="liturgical-info">
                    <div id="current-date"></div>
                    <div class="season-badge" id="season-badge"></div>
                    <div id="lectionary-info"></div>
                </div>
            </div>
        </div>

        <div class="daily-art-container">
            <img id="daily-art" class="daily-art" src="" alt="Daily meditation art">
            <div class="art-caption" id="art-caption"></div>
        </div>

        <div class="nav-buttons">
            <button class="nav-btn morning active" onclick="showOffice('morning')">Morning Prayer</button>
            <button class="nav-btn midday" onclick="showOffice('midday')">Midday Prayer</button>
            <button class="nav-btn evening" onclick="showOffice('evening')">Evening Prayer</button>
            <button class="nav-btn night" onclick="showOffice('night')">Night Prayer</button>
        </div>

        <div class="content">
            <!-- MORNING PRAYER -->
            <div id="morning" class="office-section active">
                <h2 class="section-title">Morning Prayer</h2>
                
                <div class="prayer-text">
                    <strong>Opening Sentence</strong>
                    <p id="morning-opening"></p>
                </div>

                <div class="prayer-text">
                    <strong>Call to Worship</strong>
                    <p>O Lord, open my lips.</p>
                    <p class="response">And my mouth shall proclaim your praise.</p>
                </div>

                <div class="prayer-text">
                    <strong>Morning Psalm</strong>
                    <div class="psalm" id="morning-psalm-container">
                        <div class="loading">Loading psalm...</div>
                    </div>
                </div>

                <div class="prayer-text">
                    <strong>Prayer for Illumination</strong>
                    <p>Lord, open our hearts and minds by the power of your Holy Spirit, that as the Scriptures are read and your Word is proclaimed, we may hear with joy what you say to us today. Amen.</p>
                </div>

                <div class="scripture-reading" id="morning-ot-reading">
                    <div class="loading">Loading Old Testament reading...</div>
                </div>

                <div class="scripture-reading" id="morning-epistle-reading">
                    <div class="loading">Loading Epistle reading...</div>
                </div>

                <div class="scripture-reading" id="morning-gospel-reading">
                    <div class="loading">Loading Gospel reading...</div>
                </div>

                <div class="silence-note">
                    A time of silence for reflection
                </div>

                <div class="canticle" id="morning-canticle">
                    <div class="canticle-title">Canticle: Song of Zechariah (Luke 1:68-79)</div>
                    <p>Blessed be the Lord, the God of Israel;<br>
                    he has come to his people and set them free.<br>
                    He has raised up for us a mighty savior,<br>
                    born of the house of his servant David.<br><br>
                    Through his holy prophets he promised of old,<br>
                    that he would save us from our enemies,<br>
                    from the hands of all who hate us.<br><br>
                    He promised to show mercy to our fathers<br>
                    and to remember his holy covenant.<br>
                    This was the oath he swore to our father Abraham,<br>
                    to set us free from the hands of our enemies,<br>
                    free to worship him without fear,<br>
                    holy and righteous in his sight all the days of our life.</p>
                </div>

                <div class="prayer-text">
                    <strong>Prayers of the People</strong>
                    <p>Let us pray for the church, the world, and all in need...</p>
                    <div class="silence-note">Offer your prayers and intercessions</div>
                </div>

                <div class="prayer-text">
                    <strong>The Lord's Prayer</strong>
                    <p>Our Father in heaven, hallowed be your name,<br>
                    your kingdom come, your will be done, on earth as in heaven.<br>
                    Give us today our daily bread.<br>
                    Forgive us our sins as we forgive those who sin against us.<br>
                    Save us from the time of trial and deliver us from evil.<br>
                    For the kingdom, the power, and the glory are yours now and forever. Amen.</p>
                </div>

                <div class="prayer-text">
                    <strong>Dismissal</strong>
                    <p>Let us bless the Lord.</p>
                    <p class="response">Thanks be to God.</p>
                </div>
            </div>

            <!-- MIDDAY PRAYER -->
            <div id="midday" class="office-section">
                <h2 class="section-title">Midday Prayer</h2>
                
                <div class="prayer-text">
                    <strong>Opening</strong>
                    <p>O God, come to my assistance.</p>
                    <p class="response">O Lord, hasten to help me.</p>
                </div>

                <div class="psalm" id="midday-psalm-container">
                    <div class="loading">Loading psalm...</div>
                </div>

                <div class="scripture-reading" id="midday-reading">
                    <div class="loading">Loading Scripture reading...</div>
                </div>

                <div class="canticle" id="midday-canticle">
                    <div class="canticle-title">Short Canticle</div>
                    <p>Behold, God is my salvation;<br>
                    I will trust, and will not be afraid;<br>
                    for the Lord God is my strength and my song,<br>
                    and he has become my salvation. - Isaiah 12:2</p>
                </div>

                <div class="prayer-text">
                    <strong>Midday Prayer</strong>
                    <p>Gracious God, by the power of your Spirit renew us this day, that we may continue to grow in faith and be strengthened to do your will; through Jesus Christ our Lord. Amen.</p>
                </div>

                <div class="prayer-text">
                    <strong>Dismissal</strong>
                    <p>Let us bless the Lord.</p>
                    <p class="response">Thanks be to God.</p>
                </div>
            </div>

            <!-- EVENING PRAYER -->
            <div id="evening" class="office-section">
                <h2 class="section-title">Evening Prayer</h2>
                
                <div class="prayer-text">
                    <strong>Opening Sentence</strong>
                    <p id="evening-opening"></p>
                </div>

                <div class="prayer-text">
                    <strong>Evening Thanksgiving</strong>
                    <p>Light and peace in Jesus Christ our Lord.</p>
                    <p class="response">Thanks be to God.</p>
                </div>

                <div class="prayer-text">
                    <strong>Evening Psalm</strong>
                    <div class="psalm" id="evening-psalm-container">
                        <div class="loading">Loading psalm...</div>
                    </div>
                </div>

                <div class="scripture-reading" id="evening-reading">
                    <div class="loading">Loading Scripture reading...</div>
                </div>

                <div class="silence-note">
                    A time of silence for reflection
                </div>

                <div class="canticle" id="evening-canticle">
                    <div class="canticle-title">Canticle: Song of Mary (Luke 1:46-55)</div>
                    <p>My soul proclaims the greatness of the Lord,<br>
                    my spirit rejoices in God my Savior,<br>
                    for he has looked with favor on his lowly servant.<br><br>
                    From this day all generations will call me blessed:<br>
                    the Almighty has done great things for me and holy is his name.<br>
                    He has mercy on those who fear him in every generation.<br><br>
                    He has shown the strength of his arm,<br>
                    he has scattered the proud in their conceit.<br>
                    He has cast down the mighty from their thrones,<br>
                    and has lifted up the lowly.<br><br>
                    He has filled the hungry with good things,<br>
                    and the rich he has sent away empty.<br>
                    He has come to the help of his servant Israel,<br>
                    for he has remembered his promise of mercy.</p>
                </div>

                <div class="prayer-text">
                    <strong>Prayers of Thanksgiving and Intercession</strong>
                    <div class="silence-note">Offer prayers of thanks and intercession</div>
                </div>

                <div class="prayer-text">
                    <strong>The Lord's Prayer</strong>
                    <p>Our Father in heaven, hallowed be your name,<br>
                    your kingdom come, your will be done, on earth as in heaven.<br>
                    Give us today our daily bread.<br>
                    Forgive us our sins as we forgive those who sin against us.<br>
                    Save us from the time of trial and deliver us from evil.<br>
                    For the kingdom, the power, and the glory are yours now and forever. Amen.</p>
                </div>

                <div class="prayer-text">
                    <strong>Dismissal</strong>
                    <p>Let us bless the Lord.</p>
                    <p class="response">Thanks be to God.</p>
                </div>
            </div>

            <!-- NIGHT PRAYER -->
            <div id="night" class="office-section">
                <h2 class="section-title">Night Prayer (Compline)</h2>
                
                <div class="prayer-text">
                    <strong>Opening</strong>
                    <p>The Lord Almighty grant us a peaceful night and a perfect end.</p>
                    <p class="response">Amen.</p>
                </div>

                <div class="prayer-text">
                    <strong>Confession</strong>
                    <p>Let us confess our sins against God and our neighbor.</p>
                    <div class="silence-note">Silent confession</div>
                    <p>Most merciful God, we confess that we have sinned against you in thought, word, and deed, by what we have done, and by what we have left undone. We have not loved you with our whole heart; we have not loved our neighbors as ourselves. We are truly sorry and we humbly repent. For the sake of your Son Jesus Christ, have mercy on us and forgive us; that we may delight in your will, and walk in your ways, to the glory of your name. Amen.</p>
                </div>

                <div class="psalm" id="night-psalm-container">
                    <div class="loading">Loading psalm...</div>
                </div>

                <div class="scripture-reading" id="night-reading">
                    <div class="reading-reference">Night Reading</div>
                    <div class="scripture-text">"You, O Lord, are in the midst of us, and we are called by your name; do not forsake us!" - Jeremiah 14:9</div>
                </div>

                <div class="canticle" id="night-canticle">
                    <div class="canticle-title">Canticle: Song of Simeon (Luke 2:29-32)</div>
                    <p>Lord, now let your servant go in peace;<br>
                    your word has been fulfilled.<br><br>
                    My own eyes have seen the salvation<br>
                    which you have prepared in the sight of every people:<br><br>
                    A light to reveal you to the nations<br>
                    and the glory of your people Israel.</p>
                </div>

                <div class="prayer-text">
                    <strong>Collect</strong>
                    <p>Be present, O merciful God, and protect us through the hours of this night, so that we who are wearied by the changes and chances of this life may rest in your eternal changelessness; through Jesus Christ our Lord. Amen.</p>
                </div>

                <div class="prayer-text">
                    <strong>Blessing</strong>
                    <p>The almighty and merciful Lord, Father, Son, and Holy Spirit, bless us and keep us. Amen.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Revised Common Lectionary Data (Year C - 2025)
        const lectionary2025 = {
            '2025-11-30': { 
                ot: 'Jeremiah 33:14-16',
                psalm: '25:1-10',
                epistle: '1 Thessalonians 3:9-13',
                gospel: 'Luke 21:25-36',
                theme: 'advent_hope'
            },
            '2025-12-07': { 
                ot: 'Malachi 3:1-4',
                psalm: 'Luke 1:68-79',
                epistle: 'Philippians 1:3-11',
                gospel: 'Luke 3:1-6',
                theme: 'advent_preparation'
            },
            '2025-12-14': { 
                ot: 'Zephaniah 3:14-20',
                psalm: 'Isaiah 12:2-6',
                epistle: 'Philippians 4:4-7',
                gospel: 'Luke 3:7-18',
                theme: 'advent_joy'
            },
            '2025-12-21': { 
                ot: 'Micah 5:2-5a',
                psalm: 'Luke 1:46-55',
                epistle: 'Hebrews 10:5-10',
                gospel: 'Luke 1:39-45',
                theme: 'advent_visitation'
            },
            '2025-12-25': {
                ot: 'Isaiah 52:7-10',
                psalm: '98',
                epistle: 'Hebrews 1:1-4',
                gospel: 'John 1:1-14',
                theme: 'christmas_nativity'
            },
            'default': {
                ot: 'Jeremiah 33:14-16',
                psalm: '25:1-10',
                epistle: '1 Thessalonians 3:9-13',
                gospel: 'Luke 21:25-36',
                theme: 'ordinary_faithfulness'
            }
        };

        // Enhanced religious art - using more reliable CDN sources
        const artByTheme = {
            'advent_hope': [
                { url: 'https://images.metmuseum.org/CRDImages/rl/original/DP-13759-001.jpg', caption: 'The Trinity - Andrei Rublev (1411)', day: 0 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1949.jpg', caption: 'Annunciation - Fra Angelico (1440)', day: 1 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1567.jpg', caption: 'Adoration of the Magi - Giotto (1305)', day: 2 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DP345983.jpg', caption: 'The Annunciation - El Greco (1576)', day: 3 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1951.jpg', caption: 'Madonna and Child - Perugino (1500)', day: 4 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1524.jpg', caption: 'John the Baptist - Leonardo (1516)', day: 5 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1588.jpg', caption: 'Madonna and Child - Botticelli (1470)', day: 6 }
            ],
            'advent_preparation': [
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1524.jpg', caption: 'John the Baptist - Leonardo (1516)', day: 0 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1567.jpg', caption: 'The Annunciation - Simone Martini (1333)', day: 1 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1949.jpg', caption: 'Annunciation - Fra Angelico (1440)', day: 2 },
                { url: 'https://images.metmuseum.org/CRDImages/rl/original/DP-13759-001.jpg', caption: 'The Trinity - Andrei Rublev (1411)', day: 3 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1477.jpg', caption: 'Crucifixion - Duccio (1311)', day: 4 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1588.jpg', caption: 'Madonna and Child - Botticelli (1470)', day: 5 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1567.jpg', caption: 'Adoration of the Magi - Giotto (1305)', day: 6 }
            ],
            'advent_joy': [
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1567.jpg', caption: 'The Annunciation - Simone Martini (1333)', day: 0 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1949.jpg', caption: 'Annunciation - Fra Angelico (1440)', day: 1 },
                { url: 'https://images.metmuseum.org/CRDImages/rl/original/DP-13759-001.jpg', caption: 'The Trinity - Andrei Rublev (1411)', day: 2 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1567.jpg', caption: 'Adoration of the Magi - Giotto (1305)', day: 3 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1588.jpg', caption: 'Madonna and Child - Botticelli (1470)', day: 4 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1951.jpg', caption: 'Madonna and Child - Perugino (1500)', day: 5 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DP345983.jpg', caption: 'The Annunciation - El Greco (1576)', day: 6 }
            ],
            'advent_visitation': [
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1949.jpg', caption: 'The Visitation - Albertinelli (1503)', day: 0 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1949.jpg', caption: 'Annunciation - Fra Angelico (1440)', day: 1 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1567.jpg', caption: 'The Annunciation - Simone Martini (1333)', day: 2 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1588.jpg', caption: 'Madonna and Child - Botticelli (1470)', day: 3 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1951.jpg', caption: 'Madonna and Child - Perugino (1500)', day: 4 },
                { url: 'https://images.metmuseum.org/CRDImages/rl/original/DP-13759-001.jpg', caption: 'The Trinity - Andrei Rublev (1411)', day: 5 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DP345983.jpg', caption: 'The Annunciation - El Greco (1576)', day: 6 }
            ],
            'christmas_nativity': [
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1477.jpg', caption: 'The Nativity - Duccio (1311)', day: 0 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1567.jpg', caption: 'Adoration of the Magi - Giotto (1305)', day: 1 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1951.jpg', caption: 'Madonna and Child - Perugino (1500)', day: 2 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1588.jpg', caption: 'Madonna and Child - Botticelli (1470)', day: 3 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1477.jpg', caption: 'The Nativity - Duccio (1311)', day: 4 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1567.jpg', caption: 'Adoration of the Magi - Giotto (1305)', day: 5 },
                { url: 'https://images.metmuseum.org/CRDImages/rl/original/DP-13759-001.jpg', caption: 'The Trinity - Andrei Rublev (1411)', day: 6 }
            ],
            'ordinary_faithfulness': [
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1965.jpg', caption: 'The Apostle Paul - Rembrandt (1633)', day: 0 },
                { url: 'https://images.metmuseum.org/CRDImages/rl/original/DP-13759-001.jpg', caption: 'The Trinity - Andrei Rublev (1411)', day: 1 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1477.jpg', caption: 'Crucifixion - Duccio (1311)', day: 2 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1949.jpg', caption: 'Annunciation - Fra Angelico (1440)', day: 3 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1965.jpg', caption: 'The Apostle Paul - Rembrandt (1633)', day: 4 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1567.jpg', caption: 'The Annunciation - Simone Martini (1333)', day: 5 },
                { url: 'https://images.metmuseum.org/CRDImages/ep/original/DT1567.jpg', caption: 'Adoration of the Magi - Giotto (1305)', day: 6 }
            ]
        };

        const liturgicalData = {
            2025: {
                advent: { start: '2025-11-30', end: '2025-12-24' },
                christmas: { start: '2025-12-25', end: '2026-01-05' },
                epiphany: { start: '2026-01-06', end: '2026-02-17' },
                lent: { start: '2026-02-18', end: '2026-04-04' },
                easter: { start: '2026-04-05', end: '2026-05-23' },
                pentecost: { start: '2026-05-24', end: '2025-11-29' }
            }
        };

        const morningPsalms = [95, 100, 63, 51, 19, 24, 84];
        const eveningPsalms = [141, 134, 4, 139, 23, 121, 91];
        const middayPsalms = [113, 67, 117, 119];
        const nightPsalms = [134, 91, 4, 31];

        const openingSentences = {
            advent: "In the tender mercy of our God, the dawn from on high will break upon us. - Luke 1:78",
            christmas: "The Word became flesh and lived among us, full of grace and truth. - John 1:14",
            epiphany: "Nations shall come to your light, and kings to the brightness of your dawn. - Isaiah 60:3",
            lent: "If we say that we have no sin, we deceive ourselves. If we confess our sins, God is faithful and just to forgive us. - 1 John 1:8-9",
            easter: "This is the day that the Lord has made; let us rejoice and be glad in it. - Psalm 118:24",
            pentecost: "I will pour out my Spirit upon all flesh, and your sons and daughters shall prophesy. - Acts 2:17",
            ordinary: "This is the day that the Lord has made; let us rejoice and be glad in it. - Psalm 118:24"
        };

        const embeddedScripture = {
            'Jeremiah 33:14-16': `<span class="verse-number">14</span>The days are surely coming, says the Lord, when I will fulfill the promise I made to the house of Israel and the house of Judah. <span class="verse-number">15</span>In those days and at that time I will cause a righteous Branch to spring up for David; and he shall execute justice and righteousness in the land. <span class="verse-number">16</span>In those days Judah will be saved and Jerusalem will live in safety. And this is the name by which it will be called: "The Lord is our righteousness."`,
            'Psalm 25:1-10': `<span class="verse-number">1</span>To you, O Lord, I lift up my soul. <span class="verse-number">2</span>O my God, in you I trust; do not let me be put to shame; do not let my enemies exult over me. <span class="verse-number">3</span>Do not let those who wait for you be put to shame; let them be ashamed who are wantonly treacherous. <span class="verse-number">4</span>Make me to know your ways, O Lord; teach me your paths. <span class="verse-number">5</span>Lead me in your truth, and teach me, for you are the God of my salvation; for you I wait all day long. <span class="verse-number">6</span>Be mindful of your mercy, O Lord, and of your steadfast love, for they have been from of old. <span class="verse-number">7</span>Do not remember the sins of my youth or my transgressions; according to your steadfast love remember me, for your goodness' sake, O Lord! <span class="verse-number">8</span>Good and upright is the Lord; therefore he instructs sinners in the way. <span class="verse-number">9</span>He leads the humble in what is right, and teaches the humble his way. <span class="verse-number">10</span>All the paths of the Lord are steadfast love and faithfulness, for those who keep his covenant and his decrees.`,
            '1 Thessalonians 3:9-13': `<span class="verse-number">9</span>How can we thank God enough for you in return for all the joy that we feel before our God because of you? <span class="verse-number">10</span>Night and day we pray most earnestly that we may see you face to face and restore whatever is lacking in your faith. <span class="verse-number">11</span>Now may our God and Father himself and our Lord Jesus direct our way to you. <span class="verse-number">12</span>And may the Lord make you increase and abound in love for one another and for all, just as we abound in love for you. <span class="verse-number">13</span>And may he so strengthen your hearts in holiness that you may be blameless before our God and Father at the coming of our Lord Jesus with all his saints.`,
            'Luke 21:25-36': `<span class="verse-number">25</span>"There will be signs in the sun, the moon, and the stars, and on the earth distress among nations confused by the roaring of the sea and the waves. <span class="verse-number">26</span>People will faint from fear and foreboding of what is coming upon the world, for the powers of the heavens will be shaken. <span class="verse-number">27</span>Then they will see 'the Son of Man coming in a cloud' with power and great glory. <span class="verse-number">28</span>Now when these things begin to take place, stand up and raise your heads, because your redemption is drawing near." <span class="verse-number">29</span>Then he told them a parable: "Look at the fig tree and all the trees; <span class="verse-number">30</span>as soon as they sprout leaves you can see for yourselves and know that summer is already near. <span class="verse-number">31</span>So also, when you see these things taking place, you know that the kingdom of God is near. <span class="verse-number">32</span>Truly I tell you, this generation will not pass away until all things have taken place. <span class="verse-number">33</span>Heaven and earth will pass away, but my words will not pass away. <span class="verse-number">34</span>Be on guard so that your hearts are not weighed down with dissipation and drunkenness and the worries of this life, and that day catch you unexpectedly, <span class="verse-number">35</span>like a trap. For it will come upon all who live on the face of the whole earth. <span class="verse-number">36</span>Be alert at all times, praying that you may have the strength to escape all these things that will take place, and to stand before the Son of Man."`,
            'Psalm 95': `<span class="verse-number">1</span>O come, let us sing to the Lord; let us make a joyful noise to the rock of our salvation! <span class="verse-number">2</span>Let us come into his presence with thanksgiving; let us make a joyful noise to him with songs of praise! <span class="verse-number">3</span>For the Lord is a great God, and a great King above all gods. <span class="verse-number">4</span>In his hand are the depths of the earth; the heights of the mountains are his also. <span class="verse-number">5</span>The sea is his, for he made it, and the dry land, which his hands have formed. <span class="verse-number">6</span>O come, let us worship and bow down, let us kneel before the Lord, our Maker! <span class="verse-number">7</span>For he is our God, and we are the people of his pasture, and the sheep of his hand.`,
            'Psalm 141': `<span class="verse-number">1</span>I call upon you, O Lord; come quickly to me; give ear to my voice when I call to you. <span class="verse-number">2</span>Let my prayer be counted as incense before you, and the lifting up of my hands as an evening sacrifice. <span class="verse-number">3</span>Set a guard over my mouth, O Lord; keep watch over the door of my lips. <span class="verse-number">4</span>Do not turn my heart to any evil, to busy myself with wicked deeds in company with those who work iniquity; do not let me eat of their delicacies. <span class="verse-number">5</span>Let the righteous strike me; let the faithful correct me. Never let the oil of the wicked anoint my head, for my prayer is continually against their wicked deeds.`,
            'Psalm 113': `<span class="verse-number">1</span>Praise the Lord! Praise, O servants of the Lord; praise the name of the Lord. <span class="verse-number">2</span>Blessed be the name of the Lord from this time on and forevermore. <span class="verse-number">3</span>From the rising of the sun to its setting the name of the Lord is to be praised. <span class="verse-number">4</span>The Lord is high above all nations, and his glory above the heavens. <span class="verse-number">5</span>Who is like the Lord our God, who is seated on high, <span class="verse-number">6</span>who looks far down on the heavens and the earth? <span class="verse-number">7</span>He raises the poor from the dust, and lifts the needy from the ash heap, <span class="verse-number">8</span>to make them sit with princes, with the princes of his people. <span class="verse-number">9</span>He gives the barren woman a home, making her the joyous mother of children. Praise the Lord!`,
            'Psalm 134': `<span class="verse-number">1</span>Come, bless the Lord, all you servants of the Lord, who stand by night in the house of the Lord! <span class="verse-number">2</span>Lift up your hands to the holy place, and bless the Lord. <span class="verse-number">3</span>May the Lord, maker of heaven and earth, bless you from Zion.`
        };

        function getCurrentSeason() {
            const today = new Date();
            const year = today.getFullYear();
            const dateStr = today.toISOString().split('T')[0];

            for (const [season, dates] of Object.entries(liturgicalData[year] || {})) {
                if (dateStr >= dates.start && dateStr <= dates.end) {
                    return season;
                }
            }
            return 'ordinary';
        }

        function getSeasonColor(season) {
            const colors = {
                advent: '#6B46C1',
                christmas: '#ECC94B',
                epiphany: '#48BB78',
                lent: '#805AD5',
                easter: '#F6E05E',
                pentecost: '#E53E3E',
                ordinary: '#48BB78'
            };
            return colors[season] || '#48BB78';
        }

        function getTodaysLectionary() {
            const today = new Date().toISOString().split('T')[0];
            return lectionary2025[today] || lectionary2025['default'];
        }

        function getDayOfWeek() {
            return new Date().getDay();
        }

        async function fetchScripture(reference) {
            if (embeddedScripture[reference]) {
                return {
                    reference: reference,
                    text: embeddedScripture[reference],
                    error: false
                };
            }

            try {
                const formattedRef = reference.replace(/\s/g, '%20');
                const response = await fetch(`https://bible-api.com/${formattedRef}?translation=web`, {
                    mode: 'cors'
                });
                
                if (!response.ok) {
                    throw new Error('API request failed');
                }
                
                const data = await response.json();
                return formatScriptureText(data, reference);
            } catch (error) {
                return {
                    reference: reference,
                    text: `<div class="instruction">Please read ${reference} from your Bible.</div>`,
                    error: true
                };
            }
        }

        function formatScriptureText(data, reference) {
            if (!data.verses || data.verses.length === 0) {
                return {
                    reference: reference,
                    text: `<div class="instruction">Please read ${reference} from your Bible.</div>`,
                    error: true
                };
            }

            let formattedText = '';
            data.verses.forEach(verse => {
                const verseNum = verse.verse;
                const verseText = verse.text.trim();
                formattedText += `<span class="verse-number">${verseNum}</span>${verseText} `;
            });

            return {
                reference: reference,
                text: formattedText.trim(),
                error: false
            };
        }

        async function loadMorningReadings() {
            const lectionary = getTodaysLectionary();
            
            const otReading = await fetchScripture(lectionary.ot);
            document.getElementById('morning-ot-reading').innerHTML = `
                <div class="reading-reference">Old Testament: ${otReading.reference}</div>
                <div class="scripture-text">${otReading.text}</div>
            `;

            const epistleReading = await fetchScripture(lectionary.epistle);
            document.getElementById('morning-epistle-reading').innerHTML = `
                <div class="reading-reference">Epistle: ${epistleReading.reference}</div>
                <div class="scripture-text">${epistleReading.text}</div>
            `;

            const gospelReading = await fetchScripture(lectionary.gospel);
            document.getElementById('morning-gospel-reading').innerHTML = `
                <div class="reading-reference">Gospel: ${gospelReading.reference}</div>
                <div class="scripture-text">${gospelReading.text}</div>
            `;
        }

        async function loadPsalm(psalmNumber, containerId) {
            const psalmReading = await fetchScripture(`Psalm ${psalmNumber}`);
            const container = document.getElementById(containerId);
            
            if (psalmReading.error) {
                container.innerHTML = `
                    <strong>Psalm ${psalmNumber}</strong>
                    <div class="instruction">Please read Psalm ${psalmNumber} from your Bible.</div>
                `;
            } else {
                container.innerHTML = `
                    <strong>${psalmReading.reference}</strong>
                    <div class="scripture-text">${psalmReading.text}</div>
                `;
            }
        }

        async function loadEveningReading() {
            const lectionary = getTodaysLectionary();
            const reading = await fetchScripture(lectionary.ot);
            
            document.getElementById('evening-reading').innerHTML = `
                <div class="reading-reference">${reading.reference}</div>
                <div class="scripture-text">${reading.text}</div>
            `;
        }

        async function loadMiddayReading() {
            const lectionary = getTodaysLectionary();
            const reading = await fetchScripture(lectionary.psalm);
            
            document.getElementById('midday-reading').innerHTML = `
                <div class="reading-reference">${reading.reference}</div>
                <div class="scripture-text">${reading.text}</div>
            `;
        }

        function loadDailyArt() {
            const lectionary = getTodaysLectionary();
            const dayOfWeek = getDayOfWeek();
            const theme = lectionary.theme;
            
            const artArray = artByTheme[theme] || artByTheme['ordinary_faithfulness'];
            const artData = artArray.find(art => art.day === dayOfWeek) || artArray[0];
            
            const dailyArtImg = document.getElementById('daily-art');
            const artCaption = document.getElementById('art-caption');
            
            // Set caption first
            artCaption.textContent = artData.caption;
            
            // Try to load the image
            dailyArtImg.onerror = function() {
                console.log('Image failed to load, using St Giles Cathedral');
                // Fallback to St Giles Cathedral from Unsplash (more reliable CDN)
                this.src = 'https://images.unsplash.com/photo-1580669396919-bc188bd64c68?w=400&q=80';
                artCaption.textContent = "St Giles' Cathedral, Edinburgh - The High Kirk of Scotland";
                
                // If even this fails, use a text-based fallback
                this.onerror = function() {
                    this.outerHTML = `
                        <div class="daily-art" style="display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-size: 1.2rem; text-align: center; padding: 40px;">
                            <div>
                                <div style="font-size: 3rem; margin-bottom: 10px;">‚úù</div>
                                <div>Daily Office</div>
                                <div style="font-size: 0.8rem; margin-top: 10px; opacity: 0.8;">Presbyterian Church (USA)</div>
                            </div>
                        </div>
                    `;
                    artCaption.textContent = "Book of Common Worship";
                };
            };
            
            // Set image source
            dailyArtImg.src = artData.url;
        }

        async function initializePage() {
            const today = new Date();
            const season = getCurrentSeason();
            const seasonColor = getSeasonColor(season);
            const dayIndex = getDayOfWeek();

            document.getElementById('current-date').textContent = today.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            const seasonBadge = document.getElementById('season-badge');
            seasonBadge.textContent = season.charAt(0).toUpperCase() + season.slice(1);
            seasonBadge.style.backgroundColor = seasonColor;

            document.getElementById('morning-opening').textContent = openingSentences[season];
            document.getElementById('evening-opening').textContent = openingSentences[season];
            document.getElementById('lectionary-info').textContent = 'Revised Common Lectionary - Year C';

            loadDailyArt();

            await loadMorningReadings();
            await loadPsalm(morningPsalms[dayIndex], 'morning-psalm-container');
            await loadPsalm(eveningPsalms[dayIndex], 'evening-psalm-container');
            await loadPsalm(middayPsalms[dayIndex % 4], 'midday-psalm-container');
            await loadPsalm(nightPsalms[dayIndex % 4], 'night-psalm-container');
            await loadEveningReading();
            await loadMiddayReading();
        }

        function showOffice(office) {
            document.querySelectorAll('.office-section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(office).classList.add('active');
            event.target.classList.add('active');
            document.querySelector('.content').scrollTop = 0;
        }

        initializePage();
    </script>
</body>
</html>
